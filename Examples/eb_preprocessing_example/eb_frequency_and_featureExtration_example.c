/****************************************************************************
 * Copyright (C) 2017-2018 PI2STAR                                          *
 ****************************************************************************/

/**
 * @file eb_preprocessing_example.c
 * @author Winfred SU
 * @date 28 Nov 2018
 * @brief Examples of preprocessing functions
 *
 * Demonstrates the use of the preprocessing functions. 
 */

#include "arm_math.h"
#include "edge_brain.h"

#define srcLen 400 // test data length
#define pitch 100 // base frequency
#define halfBand 20 // bandwidth 
#define dstSize 5 // Maximum order of harmonics
#define samplingRate 400 // sampling rate
#define fftSize 256 // real sequence fft length


int main(void)
{
 // uint16_t i;
	// envolop spectrum input signal and buffer ------------------------------------------------------------------
	float32_t testSrc[srcLen]={1.0,0.912471940584224,0.5825155923948968,0.07043664258818204,-0.5025256396743526,-0.9798267698572876,-1.2117541066408688,-1.1037616246411566,-0.6558576401140634,0.022653257392761642,0.7335453377854316,1.2450008419416976,1.3684183726052646,1.031927027847953,0.3217818627659622,-0.5303578536991199,-1.2186764762003093,-1.4739744831331674,-1.1746529151240217,-0.41124288011963334,0.530224087092037,1.270616679894826,1.4924578635208843,1.0841436744755937,0.2059072146173681,-0.7630657414603907,-1.385272943263648,-1.3676247584330152,-0.710850179521685,0.2748156344912931,1.1086738211962066,1.3754766093504114,0.9422544628651952,0.03829977068128234,-0.8557317368376189,-1.2618644169126596,-0.9686450858635596,-0.1546779717516608,0.7077300385443444,1.1233735062915378,0.8655706672654997,0.11214506373542114,-0.6635800991485733,-0.986585813478064,-0.6776103751151648,0.03695927814454306,0.67802324627274,0.8324199506002521,0.42570372937871337,-0.23642382288634523,-0.6874845481527366,-0.6280125202496731,-0.13062907072508914,0.4234238141118889,0.6291465662968759,0.35477387726509063,-0.16852664132577727,-0.53026279347631,-0.4579805695639226,-0.025664891393163893,0.4088192733284412,0.4912261822509809,0.15876937005921762,-0.30443921240985067,-0.49905166436852216,-0.24984111585563237,0.23049176627517412,0.5098722871705801,0.31748724588051147,-0.18984760721355878,-0.539058205340279,-0.371683362344579,0.1856744653654776,0.5939573765638113,0.41141762123272857,-0.2260760214513717,-0.6755091604937963,-0.4236443275392015,0.32345735317570873,0.7749516160067303,0.3825710237561029,-0.488479128358665,-0.8664988620899476,-0.25196279569925495,0.7174019769953933,0.8996869662808546,-0.003944436304869403,-0.9732433425414473,-0.7996130249085106,0.39513814705741146,1.167743569518082,0.4878806267273006,-0.8670168409816911,-1.1624374046657875,0.06493010705226474,1.2664612835040292,0.8156981553600954,-0.7637036028136112,-1.3552318679407536,-0.0902986894717037,1.3396078702027674,0.920034243318439,-0.8171171608655747,-1.4164117778621703,0.02295108578658081,1.4459994201199073,0.7546925724509361,-1.0585101632966578,-1.2911489232181697,0.4222790476357486,1.4831560396035441,0.2626109892797107,-1.3463083976479777,-0.8335402162176322,0.9747512980345153,1.1992048660314483,-0.4908935742886372,-1.3403538834958786,0.005142726257473078,1.2901504053520567,0.40606914609627365,-1.1081878450934624,-0.7050978116255867,0.8580895119403634,0.8866038100212056,-0.593155745716328,-0.9662989174184363,0.3502208363821724,0.9697969360350128,-0.14958153123173237,-0.9241567042484815,-0.0017141099893842851,0.8528057696638017,0.1054730382899344,-0.7733859934156652,-0.16828688505927128,0.6976060080935338,0.19843615216242144,-0.6321837093364622,-0.2038755442561736,0.5801731578397874,0.19111477457058162,-0.5422231564841633,-0.16471280679340183,0.5175201303868808,0.12713146876335046,-0.504300522104648,-0.07878993562855696,0.49989268469379333,0.01828888685811311,-0.5003017861931159,0.05709151034547971,0.4994289299449871,-0.15039996515196247,-0.48815953913025967,0.26326171179473346,0.45378562277831885,-0.3931987196584842,-0.38050828689034333,0.530201475759542,0.25197575618469936,-0.6533894046943747,-0.05670689646763995,0.7295052217052904,-0.2034944766730926,-0.7158253637012578,0.5036750048161615,0.5701625037867606,-0.7884047538905113,-0.2690569761848542,0.9733776149035133,-0.16873824805656382,-0.9628607380392671,0.6624554537529391,0.6861403244770219,-1.0679274197447217,-0.1464019470992217,1.2099467672803081,-0.5385522126100057,-0.9534410794732685,1.135620792230788,0.2952722446058137,-1.3641324059291051,0.5704917228264952,1.031429075570003,-1.2758625794752774,-0.18397959976565015,1.428187083585691,-0.8261207220107095,-0.8479133976752745,1.4561957133734709,-0.23842802301528654,-1.2753257035944368,1.2248541519724618,0.3028581224570773,-1.4540148438454445,0.8818662263442254,0.7012396766803762,-1.4495740842738192,0.5466141814380683,0.9375498442339913,-1.347360030645003,0.2880337394967027,1.036229303665178,-1.2169310179119779,0.1311702717537112,1.034321473480905,-1.0995355826406215,0.07334007556335982,0.9631134537397719,-1.0096233995939148,0.09807472938603387,0.8419697352006567,-0.9417867439524132,0.1829316903612669,0.6802307471815718,-0.8784838826167107,0.302150286608221,0.48306023127506786,-0.7972596776028672,0.4270667271101819,0.2580235792997557,-0.6775204716835975,0.5270727536137252,0.01990736119009508,-0.5064890881799483,0.572294050710858,-0.20760637873157614,-0.2832392477424318,0.536942181610238,-0.392473955520846,-0.020938923234541305,0.40189797935873783,-0.4938905196242703,0.24863018194588016,0.15985614850110522,-0.46114836579341373,0.4629396724462776,-0.16553630162604935,-0.24580928313758318,0.5175201303868814,-0.4797796820063926,0.1456957622223806,0.2965888476329947,-0.5913502557958256,0.560224829072775,-0.20379563356795882,-0.2954298213523582,0.6693478662627814,-0.7072757002997789,0.3692872475248541,0.18928778458429463,-0.6939084053445798,0.8874005892738346,-0.657747490705073,0.09441184625271852};
	float32_t testEnvolop[srcLen]; // harmonic wave magnitude buffer
	float32_t pBuffer[2*fftSize]; // insert zero to the input signal for arm_cfft_f32
	float32_t pTransMatrix[2*fftSize]; // the transform matrix for hilbert transform
	
	
	/* pFftBuffer and pMagBuffer store intermediate data */
	float32_t pFftBuffer[srcLen];
	float32_t pMagBuffer[srcLen];
	float32_t testHarmonic[dstSize]; // harmonic wave magnitude buffer
	eb_harmonic_freq_f32(testSrc,testHarmonic,pFftBuffer,pMagBuffer,pitch,halfBand,dstSize,samplingRate);

	//testSrc[srcLen]={1.0,0.912471940584224,0.5825155923948968,0.07043664258818204,-0.5025256396743526,-0.9798267698572876,-1.2117541066408688,-1.1037616246411566,-0.6558576401140634,0.022653257392761642,0.7335453377854316,1.2450008419416976,1.3684183726052646,1.031927027847953,0.3217818627659622,-0.5303578536991199,-1.2186764762003093,-1.4739744831331674,-1.1746529151240217,-0.41124288011963334,0.530224087092037,1.270616679894826,1.4924578635208843,1.0841436744755937,0.2059072146173681,-0.7630657414603907,-1.385272943263648,-1.3676247584330152,-0.710850179521685,0.2748156344912931,1.1086738211962066,1.3754766093504114,0.9422544628651952,0.03829977068128234,-0.8557317368376189,-1.2618644169126596,-0.9686450858635596,-0.1546779717516608,0.7077300385443444,1.1233735062915378,0.8655706672654997,0.11214506373542114,-0.6635800991485733,-0.986585813478064,-0.6776103751151648,0.03695927814454306,0.67802324627274,0.8324199506002521,0.42570372937871337,-0.23642382288634523,-0.6874845481527366,-0.6280125202496731,-0.13062907072508914,0.4234238141118889,0.6291465662968759,0.35477387726509063,-0.16852664132577727,-0.53026279347631,-0.4579805695639226,-0.025664891393163893,0.4088192733284412,0.4912261822509809,0.15876937005921762,-0.30443921240985067,-0.49905166436852216,-0.24984111585563237,0.23049176627517412,0.5098722871705801,0.31748724588051147,-0.18984760721355878,-0.539058205340279,-0.371683362344579,0.1856744653654776,0.5939573765638113,0.41141762123272857,-0.2260760214513717,-0.6755091604937963,-0.4236443275392015,0.32345735317570873,0.7749516160067303,0.3825710237561029,-0.488479128358665,-0.8664988620899476,-0.25196279569925495,0.7174019769953933,0.8996869662808546,-0.003944436304869403,-0.9732433425414473,-0.7996130249085106,0.39513814705741146,1.167743569518082,0.4878806267273006,-0.8670168409816911,-1.1624374046657875,0.06493010705226474,1.2664612835040292,0.8156981553600954,-0.7637036028136112,-1.3552318679407536,-0.0902986894717037,1.3396078702027674,0.920034243318439,-0.8171171608655747,-1.4164117778621703,0.02295108578658081,1.4459994201199073,0.7546925724509361,-1.0585101632966578,-1.2911489232181697,0.4222790476357486,1.4831560396035441,0.2626109892797107,-1.3463083976479777,-0.8335402162176322,0.9747512980345153,1.1992048660314483,-0.4908935742886372,-1.3403538834958786,0.005142726257473078,1.2901504053520567,0.40606914609627365,-1.1081878450934624,-0.7050978116255867,0.8580895119403634,0.8866038100212056,-0.593155745716328,-0.9662989174184363,0.3502208363821724,0.9697969360350128,-0.14958153123173237,-0.9241567042484815,-0.0017141099893842851,0.8528057696638017,0.1054730382899344,-0.7733859934156652,-0.16828688505927128,0.6976060080935338,0.19843615216242144,-0.6321837093364622,-0.2038755442561736,0.5801731578397874,0.19111477457058162,-0.5422231564841633,-0.16471280679340183,0.5175201303868808,0.12713146876335046,-0.504300522104648,-0.07878993562855696,0.49989268469379333,0.01828888685811311,-0.5003017861931159,0.05709151034547971,0.4994289299449871,-0.15039996515196247,-0.48815953913025967,0.26326171179473346,0.45378562277831885,-0.3931987196584842,-0.38050828689034333,0.530201475759542,0.25197575618469936,-0.6533894046943747,-0.05670689646763995,0.7295052217052904,-0.2034944766730926,-0.7158253637012578,0.5036750048161615,0.5701625037867606,-0.7884047538905113,-0.2690569761848542,0.9733776149035133,-0.16873824805656382,-0.9628607380392671,0.6624554537529391,0.6861403244770219,-1.0679274197447217,-0.1464019470992217,1.2099467672803081,-0.5385522126100057,-0.9534410794732685,1.135620792230788,0.2952722446058137,-1.3641324059291051,0.5704917228264952,1.031429075570003,-1.2758625794752774,-0.18397959976565015,1.428187083585691,-0.8261207220107095,-0.8479133976752745,1.4561957133734709,-0.23842802301528654,-1.2753257035944368,1.2248541519724618,0.3028581224570773,-1.4540148438454445,0.8818662263442254,0.7012396766803762,-1.4495740842738192,0.5466141814380683,0.9375498442339913,-1.347360030645003,0.2880337394967027,1.036229303665178,-1.2169310179119779,0.1311702717537112,1.034321473480905,-1.0995355826406215,0.07334007556335982,0.9631134537397719,-1.0096233995939148,0.09807472938603387,0.8419697352006567,-0.9417867439524132,0.1829316903612669,0.6802307471815718,-0.8784838826167107,0.302150286608221,0.48306023127506786,-0.7972596776028672,0.4270667271101819,0.2580235792997557,-0.6775204716835975,0.5270727536137252,0.01990736119009508,-0.5064890881799483,0.572294050710858,-0.20760637873157614,-0.2832392477424318,0.536942181610238,-0.392473955520846,-0.020938923234541305,0.40189797935873783,-0.4938905196242703,0.24863018194588016,0.15985614850110522,-0.46114836579341373,0.4629396724462776,-0.16553630162604935,-0.24580928313758318,0.5175201303868814,-0.4797796820063926,0.1456957622223806,0.2965888476329947,-0.5913502557958256,0.560224829072775,-0.20379563356795882,-0.2954298213523582,0.6693478662627814,-0.7072757002997789,0.3692872475248541,0.18928778458429463,-0.6939084053445798,0.8874005892738346,-0.657747490705073,0.09441184625271852};
	eb_envolop_spectrum_f32(testSrc,testEnvolop,pBuffer,pTransMatrix,fftSize);
		
	while(1);
}
